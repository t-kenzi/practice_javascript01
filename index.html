<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>è²·ã„ç‰©ãƒªã‚¹ãƒˆè¡¨ç¤ºã‚¢ãƒ—ãƒªï¼ˆmap / filter / reduceï¼‰</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN",
          "Noto Sans JP", sans-serif;
      }
      body {
        margin: 32px;
        line-height: 1.6;
      }
      h1 {
        margin: 0 0 8px;
      }
      .muted {
        color: #666;
        font-size: 0.95em;
      }
      .card {
        border: 1px solid #ddd;
        border-radius: 12px;
        padding: 16px;
        max-width: 720px;
      }
      ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      li {
        display: grid;
        grid-template-columns: 1fr auto auto;
        gap: 8px;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px dashed #eee;
      }
      li:last-child {
        border-bottom: none;
      }
      .price {
        min-width: 6em;
        text-align: right;
      }
      button {
        border: 1px solid #ddd;
        border-radius: 999px;
        padding: 6px 12px;
        cursor: pointer;
        background: #fafafa;
      }
      button:hover {
        background: #f0f0f0;
      }
      .total {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 16px;
        padding-top: 12px;
        border-top: 2px solid #222;
        font-weight: 700;
      }
      .empty {
        padding: 16px;
        text-align: center;
        color: #777;
      }
    </style>
  </head>
  <body>
    <!-- HTML -->
    <h1>ğŸ›’ è²·ã„ç‰©ãƒªã‚¹ãƒˆè¡¨ç¤ºã‚¢ãƒ—ãƒª</h1>
    <p class="muted">
      é…åˆ—ã‚’ <code>map</code> ã§æç”»ã—ã€<code>filter</code> ã§å‰Šé™¤ã€<code
        >reduce</code
      >
      ã§åˆè¨ˆé‡‘é¡ã‚’ç®—å‡ºã—ã¾ã™ã€‚
    </p>

    <div class="card">
      <ul id="list"></ul>
      <div id="empty" class="empty" hidden>ã‚«ãƒ¼ãƒˆã¯ç©ºã§ã™</div>
      <div class="total">
        <span>åˆè¨ˆ</span>
        <span id="totalPrice">Â¥0</span>
      </div>
    </div>

    <script>
      // åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆid, name, priceï¼‰
      let items = [
        { id: 1, name: "ç‰›ä¹³ 1L", price: 198 },
        { id: 2, name: "é£Ÿãƒ‘ãƒ³ï¼ˆ6æšåˆ‡ã‚Šï¼‰", price: 158 },
        { id: 3, name: "åµ 10å€‹", price: 298 },
        { id: 4, name: "ãƒãƒŠãƒŠ", price: 120 },
        { id: 5, name: "ãƒ¨ãƒ¼ã‚°ãƒ«ãƒˆ", price: 148 },
      ];

      const listEl = document.getElementById("list");
      const totalEl = document.getElementById("totalPrice");
      const emptyEl = document.getElementById("empty");
      const jpy = new Intl.NumberFormat("ja-JP", {
        style: "currency",
        currency: "JPY",
      });

      // æç”»é–¢æ•°ï¼šmapã§<li>ç¾¤ã‚’ä½œæˆ
      function render() {
        // ç©ºçŠ¶æ…‹ã®åˆ‡ã‚Šæ›¿ãˆ
        emptyEl.hidden = items.length !== 0;

        // mapã§HTMLæ–‡å­—åˆ—ã‚’ç”Ÿæˆ
        listEl.innerHTML = items
          .map((item) => {
            return `
            <li>
              <span>${escapeHTML(item.name)}</span>
              <span class="price">${jpy.format(item.price)}</span>
              <button data-id="${item.id}" aria-label="${
              item.name
            } ã‚’å‰Šé™¤">å‰Šé™¤</button>
            </li>
          `;
          })
          .join("");

        // reduceã§åˆè¨ˆé‡‘é¡ã‚’ç®—å‡º
        const total = items.reduce((sum, item) => sum + item.price, 0);
        totalEl.textContent = jpy.format(total);
      }

      // å‰Šé™¤ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆå§”è­²ï¼‰: filterã§æŒ‡å®šidä»¥å¤–ã‚’æ®‹ã™
      listEl.addEventListener("click", (e) => {
        const btn = e.target.closest("button[data-id]");
        if (!btn) return;
        const id = Number(btn.dataset.id);
        items = items.filter((item) => item.id !== id); // â† filter
        render();
      });

      // XSSå¯¾ç­–ï¼šæœ€ä½é™ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
      function escapeHTML(str) {
        return String(str)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#39;");
      }

      // åˆå›æç”»
      render();
    </script>
  </body>
</html>
